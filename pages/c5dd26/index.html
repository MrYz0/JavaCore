<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分库分表 | Yangzhou&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/JavaCore/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/JavaCore/assets/css/0.styles.cc85f9e9.css" as="style"><link rel="preload" href="/JavaCore/assets/js/app.dbe5bb79.js" as="script"><link rel="preload" href="/JavaCore/assets/js/2.cf8b9bc2.js" as="script"><link rel="preload" href="/JavaCore/assets/js/64.5c66ac60.js" as="script"><link rel="prefetch" href="/JavaCore/assets/js/10.9f090219.js"><link rel="prefetch" href="/JavaCore/assets/js/100.29326bf6.js"><link rel="prefetch" href="/JavaCore/assets/js/101.ed219511.js"><link rel="prefetch" href="/JavaCore/assets/js/102.1849f36a.js"><link rel="prefetch" href="/JavaCore/assets/js/103.26048576.js"><link rel="prefetch" href="/JavaCore/assets/js/104.eecd0015.js"><link rel="prefetch" href="/JavaCore/assets/js/105.61fc1cbf.js"><link rel="prefetch" href="/JavaCore/assets/js/106.ac630438.js"><link rel="prefetch" href="/JavaCore/assets/js/107.b54a458a.js"><link rel="prefetch" href="/JavaCore/assets/js/108.8037c42e.js"><link rel="prefetch" href="/JavaCore/assets/js/109.9212d109.js"><link rel="prefetch" href="/JavaCore/assets/js/11.9a7f2cc5.js"><link rel="prefetch" href="/JavaCore/assets/js/110.1f43ffb0.js"><link rel="prefetch" href="/JavaCore/assets/js/111.bdc6762f.js"><link rel="prefetch" href="/JavaCore/assets/js/112.8db475ef.js"><link rel="prefetch" href="/JavaCore/assets/js/113.1b707a82.js"><link rel="prefetch" href="/JavaCore/assets/js/114.487bbb17.js"><link rel="prefetch" href="/JavaCore/assets/js/115.cf5da376.js"><link rel="prefetch" href="/JavaCore/assets/js/116.b1a94ddc.js"><link rel="prefetch" href="/JavaCore/assets/js/117.9b286be7.js"><link rel="prefetch" href="/JavaCore/assets/js/118.92c02ebd.js"><link rel="prefetch" href="/JavaCore/assets/js/119.d10444ee.js"><link rel="prefetch" href="/JavaCore/assets/js/12.4e4bc020.js"><link rel="prefetch" href="/JavaCore/assets/js/120.e8b94366.js"><link rel="prefetch" href="/JavaCore/assets/js/121.a4b4532c.js"><link rel="prefetch" href="/JavaCore/assets/js/122.a5a58616.js"><link rel="prefetch" href="/JavaCore/assets/js/123.ac19b759.js"><link rel="prefetch" href="/JavaCore/assets/js/124.c59d8ea6.js"><link rel="prefetch" href="/JavaCore/assets/js/125.7fa7248f.js"><link rel="prefetch" href="/JavaCore/assets/js/126.58693f82.js"><link rel="prefetch" href="/JavaCore/assets/js/127.2b7164af.js"><link rel="prefetch" href="/JavaCore/assets/js/128.b0263be1.js"><link rel="prefetch" href="/JavaCore/assets/js/129.f84d6fd7.js"><link rel="prefetch" href="/JavaCore/assets/js/13.8a0efd09.js"><link rel="prefetch" href="/JavaCore/assets/js/130.01ea4ae5.js"><link rel="prefetch" href="/JavaCore/assets/js/131.be60f242.js"><link rel="prefetch" href="/JavaCore/assets/js/132.c2c51989.js"><link rel="prefetch" href="/JavaCore/assets/js/133.8f9dafb8.js"><link rel="prefetch" href="/JavaCore/assets/js/134.01e63d8c.js"><link rel="prefetch" href="/JavaCore/assets/js/135.525c2b82.js"><link rel="prefetch" href="/JavaCore/assets/js/136.63f1b874.js"><link rel="prefetch" href="/JavaCore/assets/js/137.d21c2148.js"><link rel="prefetch" href="/JavaCore/assets/js/138.624e083e.js"><link rel="prefetch" href="/JavaCore/assets/js/139.f7e8952b.js"><link rel="prefetch" href="/JavaCore/assets/js/14.498f0f13.js"><link rel="prefetch" href="/JavaCore/assets/js/140.dab308bd.js"><link rel="prefetch" href="/JavaCore/assets/js/141.1ac256fd.js"><link rel="prefetch" href="/JavaCore/assets/js/142.7a9fa726.js"><link rel="prefetch" href="/JavaCore/assets/js/143.b68131a3.js"><link rel="prefetch" href="/JavaCore/assets/js/144.82e8baaa.js"><link rel="prefetch" href="/JavaCore/assets/js/145.99979fc8.js"><link rel="prefetch" href="/JavaCore/assets/js/15.39f67d96.js"><link rel="prefetch" href="/JavaCore/assets/js/16.48d66c2b.js"><link rel="prefetch" href="/JavaCore/assets/js/17.1e056961.js"><link rel="prefetch" href="/JavaCore/assets/js/18.3f37c5b4.js"><link rel="prefetch" href="/JavaCore/assets/js/19.a00e4ca5.js"><link rel="prefetch" href="/JavaCore/assets/js/20.91ede9d4.js"><link rel="prefetch" href="/JavaCore/assets/js/21.97d95015.js"><link rel="prefetch" href="/JavaCore/assets/js/22.782f1f6b.js"><link rel="prefetch" href="/JavaCore/assets/js/23.f564b434.js"><link rel="prefetch" href="/JavaCore/assets/js/24.26e1a731.js"><link rel="prefetch" href="/JavaCore/assets/js/25.ccb93a96.js"><link rel="prefetch" href="/JavaCore/assets/js/26.c5cc88b8.js"><link rel="prefetch" href="/JavaCore/assets/js/27.5a7f3f72.js"><link rel="prefetch" href="/JavaCore/assets/js/28.a5c1dfc9.js"><link rel="prefetch" href="/JavaCore/assets/js/29.7f19c13e.js"><link rel="prefetch" href="/JavaCore/assets/js/3.046617c7.js"><link rel="prefetch" href="/JavaCore/assets/js/30.9eda9a01.js"><link rel="prefetch" href="/JavaCore/assets/js/31.4fd367a3.js"><link rel="prefetch" href="/JavaCore/assets/js/32.02b9b683.js"><link rel="prefetch" href="/JavaCore/assets/js/33.3d407681.js"><link rel="prefetch" href="/JavaCore/assets/js/34.b41236d3.js"><link rel="prefetch" href="/JavaCore/assets/js/35.46feef49.js"><link rel="prefetch" href="/JavaCore/assets/js/36.7d4b5669.js"><link rel="prefetch" href="/JavaCore/assets/js/37.d25f11ea.js"><link rel="prefetch" href="/JavaCore/assets/js/38.f22f5ab0.js"><link rel="prefetch" href="/JavaCore/assets/js/39.df5ee31c.js"><link rel="prefetch" href="/JavaCore/assets/js/4.c83a1c34.js"><link rel="prefetch" href="/JavaCore/assets/js/40.525e113b.js"><link rel="prefetch" href="/JavaCore/assets/js/41.cddbe633.js"><link rel="prefetch" href="/JavaCore/assets/js/42.1e438b80.js"><link rel="prefetch" href="/JavaCore/assets/js/43.febd76a5.js"><link rel="prefetch" href="/JavaCore/assets/js/44.7f87cee9.js"><link rel="prefetch" href="/JavaCore/assets/js/45.8d61377c.js"><link rel="prefetch" href="/JavaCore/assets/js/46.18aebce3.js"><link rel="prefetch" href="/JavaCore/assets/js/47.5088be63.js"><link rel="prefetch" href="/JavaCore/assets/js/48.69473d1a.js"><link rel="prefetch" href="/JavaCore/assets/js/49.d2efec80.js"><link rel="prefetch" href="/JavaCore/assets/js/5.1f838002.js"><link rel="prefetch" href="/JavaCore/assets/js/50.aadca120.js"><link rel="prefetch" href="/JavaCore/assets/js/51.5803f7f2.js"><link rel="prefetch" href="/JavaCore/assets/js/52.daaa1b04.js"><link rel="prefetch" href="/JavaCore/assets/js/53.8500fd5e.js"><link rel="prefetch" href="/JavaCore/assets/js/54.0fb86c99.js"><link rel="prefetch" href="/JavaCore/assets/js/55.84bfb455.js"><link rel="prefetch" href="/JavaCore/assets/js/56.1c311c57.js"><link rel="prefetch" href="/JavaCore/assets/js/57.5b86dea5.js"><link rel="prefetch" href="/JavaCore/assets/js/58.98e4c3fa.js"><link rel="prefetch" href="/JavaCore/assets/js/59.de3f9828.js"><link rel="prefetch" href="/JavaCore/assets/js/6.df6c0997.js"><link rel="prefetch" href="/JavaCore/assets/js/60.0394a173.js"><link rel="prefetch" href="/JavaCore/assets/js/61.22019e53.js"><link rel="prefetch" href="/JavaCore/assets/js/62.2ad3a891.js"><link rel="prefetch" href="/JavaCore/assets/js/63.d2471b50.js"><link rel="prefetch" href="/JavaCore/assets/js/65.1124d1dc.js"><link rel="prefetch" href="/JavaCore/assets/js/66.76d430c7.js"><link rel="prefetch" href="/JavaCore/assets/js/67.25fe71ce.js"><link rel="prefetch" href="/JavaCore/assets/js/68.5a9a18b1.js"><link rel="prefetch" href="/JavaCore/assets/js/69.a6686601.js"><link rel="prefetch" href="/JavaCore/assets/js/7.7349be35.js"><link rel="prefetch" href="/JavaCore/assets/js/70.a4fab40c.js"><link rel="prefetch" href="/JavaCore/assets/js/71.d9f3391e.js"><link rel="prefetch" href="/JavaCore/assets/js/72.2d18ca66.js"><link rel="prefetch" href="/JavaCore/assets/js/73.e9600bca.js"><link rel="prefetch" href="/JavaCore/assets/js/74.9fdebd15.js"><link rel="prefetch" href="/JavaCore/assets/js/75.41e339f7.js"><link rel="prefetch" href="/JavaCore/assets/js/76.837d8ab0.js"><link rel="prefetch" href="/JavaCore/assets/js/77.80e8e41b.js"><link rel="prefetch" href="/JavaCore/assets/js/78.8b802ab7.js"><link rel="prefetch" href="/JavaCore/assets/js/79.e8c07b67.js"><link rel="prefetch" href="/JavaCore/assets/js/8.49eea5b1.js"><link rel="prefetch" href="/JavaCore/assets/js/80.9bf88a6f.js"><link rel="prefetch" href="/JavaCore/assets/js/81.e555a891.js"><link rel="prefetch" href="/JavaCore/assets/js/82.8166fa2d.js"><link rel="prefetch" href="/JavaCore/assets/js/83.42d6ed2a.js"><link rel="prefetch" href="/JavaCore/assets/js/84.2a7891a5.js"><link rel="prefetch" href="/JavaCore/assets/js/85.5be9849a.js"><link rel="prefetch" href="/JavaCore/assets/js/86.7a7a9e12.js"><link rel="prefetch" href="/JavaCore/assets/js/87.6aef9807.js"><link rel="prefetch" href="/JavaCore/assets/js/88.1c5b0a37.js"><link rel="prefetch" href="/JavaCore/assets/js/89.fe008ebb.js"><link rel="prefetch" href="/JavaCore/assets/js/9.e8631032.js"><link rel="prefetch" href="/JavaCore/assets/js/90.376d33c9.js"><link rel="prefetch" href="/JavaCore/assets/js/91.15c5fbe3.js"><link rel="prefetch" href="/JavaCore/assets/js/92.e9fc8ac6.js"><link rel="prefetch" href="/JavaCore/assets/js/93.b7f62797.js"><link rel="prefetch" href="/JavaCore/assets/js/94.1d3a0306.js"><link rel="prefetch" href="/JavaCore/assets/js/95.3a200e03.js"><link rel="prefetch" href="/JavaCore/assets/js/96.051004dc.js"><link rel="prefetch" href="/JavaCore/assets/js/97.226de7d4.js"><link rel="prefetch" href="/JavaCore/assets/js/98.b529ae69.js"><link rel="prefetch" href="/JavaCore/assets/js/99.9d41538a.js">
    <link rel="stylesheet" href="/JavaCore/assets/css/0.styles.cc85f9e9.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/JavaCore/" class="home-link router-link-active"><img src="/JavaCore/img/logo.png" alt="Yangzhou's blog" class="logo"> <span class="site-name can-hide">Yangzhou's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaCore/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/JavaCore/guide/" class="nav-link">🔎导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/JavaCore/web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/note/java/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/list/" class="nav-link">容器</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/IO/" class="nav-link">IO</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/concurrence/" class="nav-link">并发</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/e0e559/" class="nav-link">数据算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/JavaCore/sql/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库基础和原理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/ef2a3c/" class="nav-link">数据库原理</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/ae8aaa/" class="nav-link">SQL语言</a></li></ul></li><li class="dropdown-item"><h4>SQL数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/661e9c/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/SpringMVC/" class="nav-link"></a></li></ul></li><li class="dropdown-item"><h4>NoSQL数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/8143cc480faf9a11/" class="nav-link"></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/d43ed2/" class="nav-link">Spring5</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/123407/" class="nav-link">SpringMVC</a></li></ul></li><li class="dropdown-item"><h4>SpringBoot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/b36791/" class="nav-link">♥SpringBoot 知识体系详解♥</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/0950b1/" class="nav-link">SpringBoot入门</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/4b305a/" class="nav-link">SpringBoot接口设计和实现</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/6bd46a/" class="nav-link">SpringBoot集成数据库</a></li></ul></li><li class="dropdown-item"><h4>SpringBoot2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/194038/" class="nav-link">SpringBoot基础篇</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/frame/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/JavaCore/frame/MyBatis-Plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/frame/Redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/JavaCore/frame/RabbitMQ/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🛠️工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">🛠️工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/note/java/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/SpringMVC/" class="nav-link">Docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📚项目" class="dropdown-title"><!----> <span class="title" style="display:;">📚项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/project/guli/" class="nav-link">🏫谷粒学院</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔖面经" class="dropdown-title"><!----> <span class="title" style="display:;">🔖面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/3c0dd9/" class="nav-link">备战面试</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/cd85af/" class="nav-link">Java</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/6ce629/" class="nav-link">常用框架</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/JavaCore/article/" class="nav-link">📖文章</a></div><div class="nav-item"><a href="/JavaCore/pages/8b8ebb/" class="nav-link">刷题</a></div> <a href="https://github.com/MrYz0" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/头像.jpg"> <div class="blogger-info"><h3>杨洲</h3> <span>后端界的小白</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/JavaCore/" class="nav-link">🏡首页</a></div><div class="nav-item"><a href="/JavaCore/guide/" class="nav-link">🔎导航</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/JavaCore/web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/note/java/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/list/" class="nav-link">容器</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/IO/" class="nav-link">IO</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/concurrence/" class="nav-link">并发</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/e0e559/" class="nav-link">数据算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/JavaCore/sql/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库基础和原理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/ef2a3c/" class="nav-link">数据库原理</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/ae8aaa/" class="nav-link">SQL语言</a></li></ul></li><li class="dropdown-item"><h4>SQL数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/661e9c/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/SpringMVC/" class="nav-link"></a></li></ul></li><li class="dropdown-item"><h4>NoSQL数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/8143cc480faf9a11/" class="nav-link"></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/d43ed2/" class="nav-link">Spring5</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/123407/" class="nav-link">SpringMVC</a></li></ul></li><li class="dropdown-item"><h4>SpringBoot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/b36791/" class="nav-link">♥SpringBoot 知识体系详解♥</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/0950b1/" class="nav-link">SpringBoot入门</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/4b305a/" class="nav-link">SpringBoot接口设计和实现</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/6bd46a/" class="nav-link">SpringBoot集成数据库</a></li></ul></li><li class="dropdown-item"><h4>SpringBoot2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/194038/" class="nav-link">SpringBoot基础篇</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/frame/MyBatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/JavaCore/frame/MyBatis-Plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/frame/Redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/JavaCore/frame/RabbitMQ/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🛠️工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">🛠️工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/note/java/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/JavaCore/note/SpringMVC/" class="nav-link">Docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📚项目" class="dropdown-title"><!----> <span class="title" style="display:;">📚项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/project/guli/" class="nav-link">🏫谷粒学院</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔖面经" class="dropdown-title"><!----> <span class="title" style="display:;">🔖面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/JavaCore/pages/3c0dd9/" class="nav-link">备战面试</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/cd85af/" class="nav-link">Java</a></li><li class="dropdown-subitem"><a href="/JavaCore/pages/6ce629/" class="nav-link">常用框架</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/JavaCore/article/" class="nav-link">📖文章</a></div><div class="nav-item"><a href="/JavaCore/pages/8b8ebb/" class="nav-link">刷题</a></div> <a href="https://github.com/MrYz0" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MySQL</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaCore/pages/c5dd26/" aria-current="page" class="active sidebar-link">分库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#_1-什么是分库分表" class="sidebar-link">1. 什么是分库分表</a></li><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#_2-为什么需要分库分表" class="sidebar-link">2. 为什么需要分库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_2-1-为什么需要分库呢" class="sidebar-link">2.1 为什么需要分库呢？</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_2-2-为什么需要分表" class="sidebar-link">2.2 为什么需要分表？</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#_3-如何分库分表" class="sidebar-link">3. 如何分库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_3-1-垂直拆分" class="sidebar-link">3.1 垂直拆分</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-1-1-垂直分库" class="sidebar-link">3.1.1 垂直分库</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-1-2-垂直分表" class="sidebar-link">3.1.2 垂直分表</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_3-2-水平拆分" class="sidebar-link">3.2 水平拆分</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-2-1-水平分库" class="sidebar-link">3.2.1 水平分库</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-2-2-水平分表" class="sidebar-link">3.2.2 水平分表</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_3-3-水平分库分表策略" class="sidebar-link">3.3. 水平分库分表策略</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-3-1-range范围" class="sidebar-link">3.3.1 range范围</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-3-2-hash取模" class="sidebar-link">3.3.2 hash取模</a></li><li class="sidebar-sub-header level4"><a href="/JavaCore/pages/c5dd26/#_3-3-3-range-hash取模混合" class="sidebar-link">3.3.3 range+hash取模混合</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#_4-什么时候才考虑分库分表呢" class="sidebar-link">4. 什么时候才考虑分库分表呢？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_4-1-什么时候分表" class="sidebar-link">4.1 什么时候分表？</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_4-2-什么时候分库" class="sidebar-link">4.2 什么时候分库</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#_5-分库分表会导致哪些问题" class="sidebar-link">5. 分库分表会导致哪些问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_5-1-事务问题" class="sidebar-link">5.1 事务问题</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_5-2-跨库关联" class="sidebar-link">5.2 跨库关联</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_5-3-排序问题" class="sidebar-link">5.3 排序问题</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_5-4-分页问题" class="sidebar-link">5.4 分页问题</a></li><li class="sidebar-sub-header level3"><a href="/JavaCore/pages/c5dd26/#_5-5-分布式id" class="sidebar-link">5.5 分布式ID</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaCore/pages/c5dd26/#_6-分库分表中间件" class="sidebar-link">6. 分库分表中间件</a></li></ul></li><li><a href="/JavaCore/pages/8df0e8/" class="sidebar-link">8个小妙招搞定数据库性能优化</a></li><li><a href="/JavaCore/pages/eb9f95/" class="sidebar-link">数据权限就该这么设计,yyyds！</a></li><li><a href="/JavaCore/pages/f763ef/" class="sidebar-link">数据库日期类型字段设计，应该如何选择?</a></li><li><a href="/JavaCore/pages/deaac8/" class="sidebar-link">数据库表关系详解(一对多、一对一、多对多)</a></li><li><a href="/JavaCore/pages/ad4fda/" class="sidebar-link">数据库建表的15个小技巧</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java开发手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>改变Java程序的151个建议</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/JavaCore/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/JavaCore/article/#文章" data-v-06225672>文章</a></li><li data-v-06225672><a href="/JavaCore/article/#MySQL" data-v-06225672>MySQL</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/xugaoyi" target="_blank" title="作者" class="beLink" data-v-06225672>杨洲</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">分库分表<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="分库分表"><a href="#分库分表" class="header-anchor">#</a> 分库分表</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <ol><li>什么是分库分表</li> <li>为什么需要分库分表</li> <li>如何分库分表</li> <li>什么时候开始考虑分库分表</li> <li>分库分表会导致哪些问题</li> <li>分库分表中间件简介</li></ol> <h2 id="_1-什么是分库分表"><a href="#_1-什么是分库分表" class="header-anchor">#</a> 1. 什么是分库分表</h2> <p><strong>分库</strong>：就是一个数据库分成多个数据库，部署到不同机器。</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-1.png" alt="图片"></p> <p><strong>分表</strong>：就是一个数据库表分成多个表。</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-2.png" alt="图片"></p> <h2 id="_2-为什么需要分库分表"><a href="#_2-为什么需要分库分表" class="header-anchor">#</a> 2. 为什么需要分库分表</h2> <h3 id="_2-1-为什么需要分库呢"><a href="#_2-1-为什么需要分库呢" class="header-anchor">#</a> 2.1 为什么需要分库呢？</h3> <p>如果业务量剧增，数据库可能会出现性能瓶颈，这时候我们就需要考虑拆分数据库。从这几方面来看：</p> <ul><li><strong>磁盘存储</strong></li></ul> <p>业务量剧增，MySQL单机磁盘容量会撑爆，拆成多个数据库，磁盘使用率大大降低。</p> <ul><li><strong>并发连接支撑</strong></li></ul> <p>我们知道数据库连接是有限的。在高并发的场景下，大量请求访问数据库，MySQL单机是扛不住的！当前非常火的<strong>微服务架构</strong>出现，就是为了应对高并发。它把<strong>订单、用户、商品</strong>等不同模块，拆分成多个应用，并且把单个数据库也拆分成多个不同功能模块的数据库（<strong>订单库、用户库、商品库</strong>），以分担读写压力。</p> <h3 id="_2-2-为什么需要分表"><a href="#_2-2-为什么需要分表" class="header-anchor">#</a> 2.2 为什么需要分表？</h3> <p>数据量太大的话，SQL的查询就会变慢。如果一个查询SQL<strong>没命中索引</strong>，千百万数据量级别的表可能会拖垮整个数据库。</p> <p>即使SQL命中了索引，如果表的数据量<strong>超过一千万</strong>的话，<strong>查询也是会明显变慢的</strong>。这是因为索引一般是B+树结构，数据千万级别的话，B+树的高度会增高，查询就变慢啦。</p> <p><strong>小伙伴们是否还记得，MySQL的B+树的高度怎么计算的呢？</strong> 顺便复习一下吧</p> <p>InnoDB存储引擎最小储存单元是页，一页大小就是16k。B+树叶子存的是数据，内部节点存的是键值+指针。索引组织表通过非叶子节点的二分查找法以及指针确定数据在哪个页中，进而再去数据页中找到需要的数据，B+树结构图如下：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-3.png" alt="图片"></p> <p>假设B+树的高度为2的话，即有一个根结点和若干个叶子结点。这棵B+树的存放总记录数为=根结点指针数*单个叶子节点记录行数。</p> <ul><li>如果一行记录的数据大小为1k，那么单个叶子节点可以存的记录数  <code>=16k/1k =16</code>.</li> <li>非叶子节点内存放多少指针呢？我们假设主键ID为<strong>bigint类型，长度为8字节</strong>(<strong>面试官问你int类型，一个int就是32位，4字节</strong>)，而指针大小在InnoDB源码中设置为6字节，所以就是 <code>8+6=14</code>字节，<code>16k/14B =16*1024B/14B = 1170</code></li></ul> <p>因此，一棵高度为2的B+树，能存放<code>1170 * 16=18720</code>条这样的数据记录。同理一棵高度为<code>3</code>的B+树，能存放<code>1170 *1170 *16 =21902400</code>，大概可以存放两千万左右的记录。B+树高度一般为1-3层，如果B+到了4层，查询的时候会<strong>多查磁盘</strong>的次数，SQL就会变慢。</p> <p>因此单表数据量太大，SQL查询会变慢，所以就需要考虑分表啦。</p> <h2 id="_3-如何分库分表"><a href="#_3-如何分库分表" class="header-anchor">#</a> 3. 如何分库分表</h2> <h3 id="_3-1-垂直拆分"><a href="#_3-1-垂直拆分" class="header-anchor">#</a> 3.1 垂直拆分</h3> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-4.png" alt="图片"></p> <h4 id="_3-1-1-垂直分库"><a href="#_3-1-1-垂直分库" class="header-anchor">#</a> 3.1.1 垂直分库</h4> <p>在业务发展初期，业务功能模块比较少，为了快速上线和迭代，往往采用单个数据库来保存数据。数据库架构如下：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-5.png" alt="图片"></p> <p>但是随着业务蒸蒸日上，系统功能逐渐完善。这时候，可以按照系统中的不同业务进行拆分，比如拆分成<strong>用户库、订单库、积分库、商品库</strong>，把它们部署在不同的数据库服务器，这就是<strong>垂直分库</strong>。</p> <p>垂直分库，将原来一个单数据库的压力分担到不同的数据库，可以很好应对高并发场景。数据库垂直拆分后的架构如下：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-6.png" alt="图片"></p> <h4 id="_3-1-2-垂直分表"><a href="#_3-1-2-垂直分表" class="header-anchor">#</a> 3.1.2 垂直分表</h4> <p>如果一个单表包含了几十列甚至上百列，管理起来很混乱，每次都<code>select *</code>的话，还占用IO资源。这时候，我们可以将一些<strong>不常用的、数据较大或者长度较长的列</strong>拆分到另外一张表。</p> <p>比如一张用户表，它包含<code>user_id、user_name、mobile_no、age、email、nickname、address、user_desc</code>，如果<code>email、address、user_desc</code>等字段不常用，我们可以把它拆分到另外一张表，命名为用户详细信息表。这就是垂直分表</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-7.png" alt="图片"></p> <h3 id="_3-2-水平拆分"><a href="#_3-2-水平拆分" class="header-anchor">#</a> 3.2 水平拆分</h3> <h4 id="_3-2-1-水平分库"><a href="#_3-2-1-水平分库" class="header-anchor">#</a> 3.2.1 水平分库</h4> <p>水平分库是指，将表的数据量切分到不同的数据库服务器上，每个服务器具有相同的库和表，只是表中的数据集合不一样。它可以有效的缓解单机单库的性能瓶颈和压力。</p> <p>用户库的水平拆分架构如下：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-8.png" alt="图片"></p> <h4 id="_3-2-2-水平分表"><a href="#_3-2-2-水平分表" class="header-anchor">#</a> 3.2.2 水平分表</h4> <p>如果一个表的数据量太大，可以按照某种规则（如<code>hash取模、range</code>），把数据切分到多张表去。</p> <p>一张订单表，按<code>时间range</code>拆分如下：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-9.png" alt="图片"></p> <h3 id="_3-3-水平分库分表策略"><a href="#_3-3-水平分库分表策略" class="header-anchor">#</a> 3.3. 水平分库分表策略</h3> <p>分库分表策略一般有几种，使用与不同的场景：</p> <ul><li>range范围</li> <li>hash取模</li> <li>range+hash取模混合</li></ul> <h4 id="_3-3-1-range范围"><a href="#_3-3-1-range范围" class="header-anchor">#</a> 3.3.1 range范围</h4> <p>range，即范围策略划分表。比如我们可以将表的主键，按照从<code>0~1000万</code>的划分为一个表，<code>1000~2000万</code>划分到另外一个表。如下图：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-10.png" alt="图片"></p> <p>当然，有时候我们也可以按时间范围来划分，如不同年月的订单放到不同的表，它也是一种range的划分策略。</p> <p><strong>这种方案的优点：</strong></p> <ul><li>这种方案有利于扩容，不需要数据迁移。假设数据量增加到5千万，我们只需要水平增加一张表就好啦，之前<code>0~4000万</code>的数据，不需要迁移。</li></ul> <p><strong>缺点：</strong></p> <ul><li>这种方案会有热点问题，因为订单id是一直在增大的，也就是说最近一段时间都是汇聚在一张表里面的。比如最近一个月的订单都在<code>1000万~2000</code>万之间，平时用户一般都查最近一个月的订单比较多，请求都打到<code>order_1</code>表啦，这就导致<strong>数据热点</strong>问题。</li></ul> <h4 id="_3-3-2-hash取模"><a href="#_3-3-2-hash取模" class="header-anchor">#</a> 3.3.2 hash取模</h4> <p>hash取模策略：指定的路由key（一般是user_id、订单id作为key）对分表总数进行取模，把数据分散到各个表中。</p> <p>比如原始订单表信息，我们把它分成4张分表：</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-11.png" alt="图片"></p> <ul><li>比如id=1，对4取模，就会得到1，就把它放到<code>t_order_1</code>;</li> <li>id=3，对4取模，就会得到3，就把它放到<code>t_order_3</code>;</li></ul> <p><strong>这种方案的优点：</strong></p> <ul><li>hash取模的方式，不会存在明显的热点问题。</li></ul> <p><strong>缺点：</strong></p> <ul><li>如果一开始按照hash取模分成4个表了，未来某个时候，表数据量又到瓶颈了，需要扩容，这就比较棘手了。比如你从4张表，又扩容成<code>8</code>张表，那之前<code>id=5</code>的数据是在（<code>5%4=1</code>，即t_order_1），现在应该放到（<code>5%8=5</code>，即t_order_5），也就是说<strong>历史数据要做迁移了</strong>。</li></ul> <h4 id="_3-3-3-range-hash取模混合"><a href="#_3-3-3-range-hash取模混合" class="header-anchor">#</a> 3.3.3 range+hash取模混合</h4> <p>既然range存在热点数据问题，hash取模扩容迁移数据比较困难，我们可以综合两种方案一起嘛，取之之长，弃之之短。</p> <p>比较简单的做法就是，在拆分库的时候，我们可以先用<strong>range范围</strong>方案，比如订单id在0~4000万的区间，划分为订单库1;id在4000万~8000万的数据，划分到订单库2,将来要扩容时，id在8000万~1.2亿的数据，划分到订单库3。然后订单库内，再用<strong>hash取模</strong>的策略，把不同订单划分到不同的表。</p> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-12.png" alt="图片"></p> <h2 id="_4-什么时候才考虑分库分表呢"><a href="#_4-什么时候才考虑分库分表呢" class="header-anchor">#</a> 4. 什么时候才考虑分库分表呢？</h2> <h3 id="_4-1-什么时候分表"><a href="#_4-1-什么时候分表" class="header-anchor">#</a> 4.1 什么时候分表？</h3> <p>如果你的系统处于快速发展时期，如果每天的订单流水都新增几十万，并且，订单表的查询效率明变慢时，就需要规划分库分表了。一般B+树索引高度是2~3层最佳，如果<strong>数据量千万级别</strong>，可能高度就变4层了，数据量就会明显变慢了。不过业界流传，一般500万数据就要<strong>考虑分表</strong>了。</p> <h3 id="_4-2-什么时候分库"><a href="#_4-2-什么时候分库" class="header-anchor">#</a> 4.2 什么时候分库</h3> <p>业务发展很快，还是多个服务共享一个单体数据库，数据库成为了性能瓶颈，就需要考虑分库了。比如订单、用户等，都可以抽取出来，新搞个应用（其实就是微服务思想），并且拆分数据库（订单库、用户库）。</p> <h2 id="_5-分库分表会导致哪些问题"><a href="#_5-分库分表会导致哪些问题" class="header-anchor">#</a> 5. 分库分表会导致哪些问题</h2> <p>分库分表之后，也会存在一些问题：</p> <ul><li>事务问题</li> <li>跨库关联</li> <li>排序问题</li> <li>分页问题</li> <li>分布式ID</li></ul> <h3 id="_5-1-事务问题"><a href="#_5-1-事务问题" class="header-anchor">#</a> 5.1 事务问题</h3> <p>分库分表后，假设两个表在不同的数据库，那么本地事务已经无效啦，需要使用分布式事务了。</p> <h3 id="_5-2-跨库关联"><a href="#_5-2-跨库关联" class="header-anchor">#</a> 5.2 跨库关联</h3> <p>跨节点Join的问题：解决这一问题可以分两次查询实现</p> <h3 id="_5-3-排序问题"><a href="#_5-3-排序问题" class="header-anchor">#</a> 5.3 排序问题</h3> <p>跨节点的count,order by,group by以及聚合函数等问题：可以分别在各个节点上得到结果后在应用程序端进行合并。</p> <h3 id="_5-4-分页问题"><a href="#_5-4-分页问题" class="header-anchor">#</a> 5.4 分页问题</h3> <ul><li>方案1：在个节点查到对应结果后，在代码端汇聚再分页。</li> <li>方案2：把分页交给前端，前端传来pageSize和pageNo，在各个数据库节点都执行分页，然后汇聚总数量前端。这样缺点就是会造成空查，如果分页需要排序，也不好搞。</li></ul> <h3 id="_5-5-分布式id"><a href="#_5-5-分布式id" class="header-anchor">#</a> 5.5 分布式ID</h3> <p>数据库被切分后，不能再依赖数据库自身的主键生成机制啦，最简单可以考虑UUID，或者使用雪花算法生成分布式ID。</p> <h2 id="_6-分库分表中间件"><a href="#_6-分库分表中间件" class="header-anchor">#</a> 6. 分库分表中间件</h2> <p>目前流行的分库分表中间件比较多：</p> <ul><li>cobar</li> <li>Mycat</li> <li>Sharding-JDBC</li> <li>Atlas</li> <li>TDDL（淘宝）</li> <li>vitess</li></ul> <p><img src="http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/fkfb-13.png" alt="图片"></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/MrYz0/edit/master/docs/07.文章/02.MySQL/01.分库分表.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/JavaCore/pages/1ccd5f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">微服务架构的演进</div></a> <a href="/JavaCore/pages/8df0e8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">8个小妙招搞定数据库性能优化</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/JavaCore/pages/1ccd5f/" class="prev">微服务架构的演进</a></span> <span class="next"><a href="/JavaCore/pages/8df0e8/">8个小妙招搞定数据库性能优化</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/JavaCore/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/JavaCore/pages/43ff41/"><div>
            深入理解Java String类型
            <!----></div></a> <span class="date">09-23</span></dt></dl><dl><dd>02</dd> <dt><a href="/JavaCore/pages/80ae21/"><div>
            Java常用工具类
            <!----></div></a> <span class="date">09-23</span></dt></dl><dl><dd>03</dd> <dt><a href="/JavaCore/pages/397652/"><div>
            深入理解Java注解
            <!----></div></a> <span class="date">09-23</span></dt></dl> <dl><dd></dd> <dt><a href="/JavaCore/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/MrYz0" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Yang zhou | <a href="" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/JavaCore/assets/js/app.dbe5bb79.js" defer></script><script src="/JavaCore/assets/js/2.cf8b9bc2.js" defer></script><script src="/JavaCore/assets/js/64.5c66ac60.js" defer></script>
  </body>
</html>
