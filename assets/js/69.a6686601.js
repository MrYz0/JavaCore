(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{376:function(s,t,a){"use strict";a.r(t);var e=a(6),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("对于后端开发同学来说，访问数据库，是代码中必不可少的一个环节。")]),s._v(" "),t("p",[s._v("系统中收集到用户的核心数据，为了安全性，我们一般会存储到数据库，比如：mysql，oracle等。")]),s._v(" "),t("p",[s._v("后端开发的日常工作，需要不断的建库和建表，来满足业务需求。")]),s._v(" "),t("p",[s._v("通常情况下，建库的频率比建表要低很多，所以，我们这篇文章主要讨论建表相关的内容。")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E8%A1%A8%E7%9A%8415%E4%B8%AA%E6%8A%80%E5%B7%A7.png",alt:"数据库建表的15个技巧"}})]),s._v(" "),t("h2",{attrs:{id:"_1、名字"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、名字"}},[s._v("#")]),s._v(" 1、名字")]),s._v(" "),t("p",[s._v("建表的时候，给"),t("code",[s._v("表")]),s._v("、"),t("code",[s._v("字段")]),s._v("和"),t("code",[s._v("索引")]),s._v("起个好名字，真的太重要了。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-见名知意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-见名知意"}},[s._v("#")]),s._v(" 1.1 见名知意")]),s._v(" "),t("p",[s._v("名字就像"),t("code",[s._v("表")]),s._v("、"),t("code",[s._v("字段")]),s._v("和"),t("code",[s._v("索引")]),s._v("的一张脸，可以给人留下第一印象。")]),s._v(" "),t("p",[s._v("好的名字，言简意赅，见名知意，让人心情愉悦，能够提高沟通和维护成本。")]),s._v(" "),t("p",[s._v("坏的名字，模棱两可，不知所云。而且显得杂乱无章，看得让人抓狂。")]),s._v(" "),t("p",[t("span",{staticStyle:{color:"#FF8C00"}},[t("strong",[s._v("反例：")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("用户名称字段定义成：yong_hu_ming、用户_name、name、user_name_123456789\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("span",{staticStyle:{color:"green"}},[t("strong",[s._v("正例：")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("用户名称字段定义成：user_name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("温馨提醒一下，名字也不宜过长，尽量控制在"),t("code",[s._v("30")]),s._v("个字符以内。")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-大小写"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-大小写"}},[s._v("#")]),s._v(" 1.2 大小写")]),s._v(" "),t("p",[s._v("名字尽量都用"),t("code",[s._v("小写字母")]),s._v("，因为从视觉上，小写字母更容易让人读懂。")]),s._v(" "),t("p",[t("span",{staticStyle:{color:"#FF8C00"}},[t("strong",[s._v("反例：")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("字段名：PRODUCT_NAME、PRODUCT_name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("全部大写，看起来有点不太直观。而一部分大写，一部分小写，让人看着更不爽。")]),s._v(" "),t("p",[t("span",{staticStyle:{color:"green"}},[t("strong",[s._v("正例：")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("字段名：product_name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("名字还是使用全小写字母，看着更舒服。")]),s._v(" "),t("h3",{attrs:{id:"_1-3-分隔符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-分隔符"}},[s._v("#")]),s._v(" 1.3 分隔符")]),s._v(" "),t("p",[s._v("很多时候，名字为了让人好理解，有可能会包含多个单词。")]),s._v(" "),t("p",[s._v("那么，多个单词间的"),t("code",[s._v("分隔符")]),s._v("该用什么呢？")]),s._v(" "),t("p",[t("span",{staticStyle:{color:"#FF8C00"}},[t("strong",[s._v("反例：")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("字段名：productname、productName、product name、product"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@name")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("单词间没有分隔，或者单词间用驼峰标识，或者单词间用空格分隔，或者单词间用@分隔，这几种方式都不太建议。")]),s._v(" "),t("p",[t("span",{staticStyle:{color:"green"}},[t("strong",[s._v("正例：")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("字段名：product_name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("强烈建议大家在单词间用"),t("code",[s._v("_")]),s._v("分隔。")]),s._v(" "),t("h3",{attrs:{id:"_1-4-表名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-表名"}},[s._v("#")]),s._v(" 1.4 表名")]),s._v(" "),t("p",[s._v("对于表名，在言简意赅，见名知意的基础之上，建议带上"),t("code",[s._v("业务前缀")]),s._v("。")]),s._v(" "),t("p",[s._v("如果是订单相关的业务表，可以在表名前面加个前缀："),t("code",[s._v("order_")]),s._v("。")]),s._v(" "),t("p",[s._v("例如：order_pay、order_pay_detail等。")]),s._v(" "),t("p",[s._v("如果是商品相关的业务表，可以在表名前面加个前缀："),t("code",[s._v("product_")]),s._v("。")]),s._v(" "),t("p",[s._v("例如：product_spu，product_sku等。")]),s._v(" "),t("p",[s._v("这样做的好处是为了方便归类，把相同业务的表，可以非常快速的聚集到一起。")]),s._v(" "),t("p",[s._v("另外，还有有个好处是，如果哪天有非订单的业务，比如：金融业务，也需要建一个名字叫做pay的表，可以取名：finance_pay，就能非常轻松的区分。")]),s._v(" "),t("p",[s._v("这样就不会出现"),t("code",[s._v("同名表")]),s._v("的情况。")]),s._v(" "),t("h3",{attrs:{id:"_1-5-字段名称"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-字段名称"}},[s._v("#")]),s._v(" 1.5 字段名称")]),s._v(" "),t("p",[t("code",[s._v("字段名称")]),s._v("是开发人员发挥空间最大，但也最容易发生混乱的地方。")]),s._v(" "),t("p",[s._v("比如有些表，使用flag表示状态，另外的表用status表示状态。")]),s._v(" "),t("p",[s._v("可以统一一下，使用status表示状态。")]),s._v(" "),t("p",[s._v("如果一个表使用了另一个表的主键，可以在另一张表的名后面，加"),t("code",[s._v("_id")]),s._v("或"),t("code",[s._v("_sys_no")]),s._v("，例如：")]),s._v(" "),t("p",[s._v("在product_sku表中有个字段，是product_spu表的主键，这时候可以取名：product_spu_id或product_spu_sys_no。")]),s._v(" "),t("p",[s._v("还有创建时间，可以统一成：create_time，修改时间统一成：update_time。")]),s._v(" "),t("p",[s._v("删除状态固定为：delete_status。")]),s._v(" "),t("p",[s._v("其实还有很多公共字段，在不同的表之间，可以使用全局统一的命名规则，定义成相同的名称，以便于大家好理解。")]),s._v(" "),t("h3",{attrs:{id:"_1-6-索引名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-索引名"}},[s._v("#")]),s._v(" 1.6 索引名")]),s._v(" "),t("p",[s._v("在数据库中，索引有很多种，包括：主键、普通索引、唯一索引、联合索引等。")]),s._v(" "),t("p",[s._v("每张表的主键只有一个，一般使用："),t("code",[s._v("id")]),s._v("或者"),t("code",[s._v("sys_no")]),s._v("命名。")]),s._v(" "),t("p",[s._v("普通索引和联合索引，其实是一类。在建立该类索引时，可以加"),t("code",[s._v("ix_")]),s._v("前缀，比如：ix_product_status。")]),s._v(" "),t("p",[s._v("唯一索引，可以加"),t("code",[s._v("ux_")]),s._v("前缀，比如：ux_product_code。")]),s._v(" "),t("h2",{attrs:{id:"_2、字段类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、字段类型"}},[s._v("#")]),s._v(" 2、字段类型")]),s._v(" "),t("p",[s._v("在设计表时，我们在选择"),t("code",[s._v("字段类型")]),s._v("时，可发挥空间很大。")]),s._v(" "),t("p",[s._v("时间格式的数据有：date、datetime和timestamp等等可以选择。")]),s._v(" "),t("p",[s._v("字符类型的数据有：varchar、char、text等可以选择。")]),s._v(" "),t("p",[s._v("数字类型的数据有：int、bigint、smallint、tinyint等可以选择。")]),s._v(" "),t("p",[s._v("说实话，选择很多，有时候是一件好事，也可能是一件坏事。")]),s._v(" "),t("p",[s._v("如何选择一个"),t("code",[s._v("合适")]),s._v("的字段类型，变成了我们不得不面对的问题。")]),s._v(" "),t("p",[s._v("如果字段类型选大了，比如：原本只有1-10之间的10个数字，结果选了"),t("code",[s._v("bigint")]),s._v("，它占"),t("code",[s._v("8")]),s._v("个字节。")]),s._v(" "),t("p",[s._v("其实，1-10之间的10个数字，每个数字"),t("code",[s._v("1")]),s._v("个字节就能保存，选择"),t("code",[s._v("tinyint")]),s._v("更为合适。")]),s._v(" "),t("p",[s._v("这样会白白浪费7个字节的空间。")]),s._v(" "),t("p",[s._v("如果字段类型择小了，比如：一个18位的id字段，选择了"),t("code",[s._v("int")]),s._v("类型，最终数据会保存失败。")]),s._v(" "),t("p",[s._v("所以选择一个合适的字段类型，还是非常重要的一件事情。")]),s._v(" "),t("p",[s._v("以下原则可以参考一下：")]),s._v(" "),t("ol",[t("li",[s._v("尽可能选择占用存储空间小的字段类型，在满足正常业务需求的情况下，从小到大，往上选。")]),s._v(" "),t("li",[s._v("如果字符串长度固定，或者差别不大，可以选择char类型。如果字符串长度差别较大，可以选择varchar类型。")]),s._v(" "),t("li",[s._v("是否字段，可以选择bit类型。")]),s._v(" "),t("li",[s._v("枚举字段，可以选择tinyint类型。")]),s._v(" "),t("li",[s._v("主键字段，可以选择bigint类型。")]),s._v(" "),t("li",[s._v("金额字段，可以选择decimal类型。")]),s._v(" "),t("li",[s._v("时间字段，可以选择timestamp或datetime类型。")])]),s._v(" "),t("h2",{attrs:{id:"_3、字段长度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、字段长度"}},[s._v("#")]),s._v(" 3、字段长度")]),s._v(" "),t("p",[s._v("前面我们已经定义好了"),t("code",[s._v("字段名称")]),s._v("，选择了合适的"),t("code",[s._v("字段类型")]),s._v("，接下来，需要重点关注的是"),t("code",[s._v("字段长度")]),s._v("了。")]),s._v(" "),t("p",[s._v("比如：varchar(20)，biginit(20)等。")]),s._v(" "),t("p",[s._v("那么问题来了，"),t("code",[s._v("varchar")]),s._v("代表的是"),t("code",[s._v("字节")]),s._v("长度，还是"),t("code",[s._v("字符")]),s._v("长度呢？")]),s._v(" "),t("p",[s._v("答：在mysql中除了"),t("code",[s._v("varchar")]),s._v("和"),t("code",[s._v("char")]),s._v("是代表"),t("code",[s._v("字符")]),s._v("长度之外，其余的类型都是代表"),t("code",[s._v("字节")]),s._v("长度。")]),s._v(" "),t("p",[s._v("biginit(n) 这个"),t("code",[s._v("n")]),s._v("表示什么意思呢？")]),s._v(" "),t("p",[s._v("假如我们定义的字段类型和长度是：bigint(4)，bigint实际长度是"),t("code",[s._v("8")]),s._v("个字节。")]),s._v(" "),t("p",[s._v("现在有个数据a=1，a显示4个字节，所以在不满4个字节时前面填充0（前提是该字段设置了zerofill属性），比如：0001。")]),s._v(" "),t("p",[s._v("当满了4个字节时，比如现在数据是a=123456，它会按照实际的长度显示，比如：123456。")]),s._v(" "),t("p",[s._v("但需要注意的是，有些mysql客户端即使满了4个字节，也可能只显示4个字节的内容，比如会显示成：1234。")]),s._v(" "),t("p",[s._v("所以bigint(4)，这里的4表示显示的长度为4个字节，实际长度还是占8个字节。")]),s._v(" "),t("h2",{attrs:{id:"_4、字段个数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、字段个数"}},[s._v("#")]),s._v(" 4、字段个数")]),s._v(" "),t("p",[s._v("我们在建表的时候，一定要对"),t("code",[s._v("字段个数")]),s._v("做一些限制。")]),s._v(" "),t("p",[s._v("我之前见过有人创建的表，有几十个，甚至上百个字段，表中保存的数据非常大，查询效率很低。")]),s._v(" "),t("p",[s._v("如果真有这种情况，可以将一张"),t("code",[s._v("大表")]),s._v("拆成多张"),t("code",[s._v("小表")]),s._v("，这几张表的主键相同。")]),s._v(" "),t("p",[s._v("建议每表的字段个数，不要超过"),t("code",[s._v("20")]),s._v("个。")]),s._v(" "),t("h2",{attrs:{id:"_5、主键"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、主键"}},[s._v("#")]),s._v(" 5、主键")]),s._v(" "),t("p",[s._v("在创建表时，一定要创建"),t("code",[s._v("主键")]),s._v("。")]),s._v(" "),t("p",[s._v("因为主键自带了主键索引，相比于其他索引，主键索引的查询效率最高，因为它不需要回表。")]),s._v(" "),t("p",[s._v("此外，主键还是天然的"),t("code",[s._v("唯一索引")]),s._v("，可以根据它来判重。")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("单个")]),s._v("数据库中，主键可以通过"),t("code",[s._v("AUTO_INCREMENT")]),s._v("，设置成"),t("code",[s._v("自动增长")]),s._v("的。")]),s._v(" "),t("p",[s._v("但在"),t("code",[s._v("分布式")]),s._v("数据库中，特别是做了分库分表的业务库中，主键最好由外部算法(比如：雪花算法）生成，它能够保证生成的id是全局唯一的。")]),s._v(" "),t("p",[s._v("除此之外，主键建议保存跟业务无关的值，减少业务耦合性，方便今后的扩展。")]),s._v(" "),t("p",[s._v("不过我也见过，有些一对一的表关系，比如：用户表和用户扩展表，在保存数据时是一对一的关系。")]),s._v(" "),t("p",[s._v("这样，用户扩展表的主键，可以直接保存用户表的主键。")]),s._v(" "),t("h2",{attrs:{id:"_6、存储引擎"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、存储引擎"}},[s._v("#")]),s._v(" 6、存储引擎")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("mysql8")]),s._v("以前的版本，默认的存储引擎是"),t("code",[s._v("myslam")]),s._v("，而"),t("code",[s._v("mysql8")]),s._v("以后的版本，默认的存储引擎变成了"),t("code",[s._v("innodb")]),s._v("。")]),s._v(" "),t("p",[s._v("之前我们还在创建表时，还一直纠结要选哪种存储引擎？")]),s._v(" "),t("p",[t("code",[s._v("myslam")]),s._v("的索引和数据分开存储，而有利于查询，但它不支持事务和外键等功能。")]),s._v(" "),t("p",[s._v("而"),t("code",[s._v("innodb")]),s._v("虽说查询性能，稍微弱一点，但它支持事务和外键等，功能更强大一些。")]),s._v(" "),t("p",[s._v("以前的建议是：读多写少的表，用myslam存储引擎。而写多读多的表，用innodb。")]),s._v(" "),t("p",[s._v("但虽说mysql对innodb存储引擎性能的不断优化，现在myslam和innodb查询性能相差已经越来越小。")]),s._v(" "),t("p",[s._v("所以，建议我们在使用"),t("code",[s._v("mysql8")]),s._v("以后的版本时，直接使用默认的"),t("code",[s._v("innodb")]),s._v("存储引擎即可，无需额外修改存储引擎。")]),s._v(" "),t("h2",{attrs:{id:"_7、not-null"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7、not-null"}},[s._v("#")]),s._v(" 7、NOT NULL")]),s._v(" "),t("p",[s._v("在创建字段时，需要选择该字段是否允许为"),t("code",[s._v("NULL")]),s._v("。")]),s._v(" "),t("p",[s._v("我们在定义字段时，应该尽可能明确该字段"),t("code",[s._v("NOT NULL")]),s._v("。")]),s._v(" "),t("p",[s._v("为什么呢？")]),s._v(" "),t("p",[s._v("我们主要以innodb存储引擎为例，myslam存储引擎没啥好说的。")]),s._v(" "),t("p",[s._v("主要有以下原因：")]),s._v(" "),t("ol",[t("li",[s._v("在innodb中，需要额外的空间存储null值，需要占用更多的空间。")]),s._v(" "),t("li",[s._v("null值可能会导致索引失效。")]),s._v(" "),t("li",[s._v("null值只能用"),t("code",[s._v("is null")]),s._v("或者"),t("code",[s._v("is not null")]),s._v("判断，用"),t("code",[s._v("=号")]),s._v("判断永远返回false。")])]),s._v(" "),t("p",[s._v("因此，建议我们在定义字段时，能定义成NOT NULL，就定义成NOT NULL。")]),s._v(" "),t("p",[s._v("但如果某个字段直接定义成NOT NULL，万一有些地方忘了给该字段写值，就会"),t("code",[s._v("insert")]),s._v("不了数据。")]),s._v(" "),t("p",[s._v("这也算合理的情况。")]),s._v(" "),t("p",[s._v("但有一种情况是，系统有新功能上线，新增了字段。上线时一般会先执行sql脚本，再部署代码。")]),s._v(" "),t("p",[s._v("由于老代码中，不会给新字段赋值，则insert数据时，也会报错。")]),s._v(" "),t("p",[s._v("由此，非常有必要给NOT NULL的字段设置默认值，特别是后面新增的字段。")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" product_sku "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v("  brand_id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_8、外键"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8、外键"}},[s._v("#")]),s._v(" 8、外键")]),s._v(" "),t("p",[s._v("在mysql中，是存在"),t("code",[s._v("外键")]),s._v("的。")]),s._v(" "),t("p",[s._v("外键存在的主要作用是：保证数据的"),t("code",[s._v("一致性")]),s._v("和"),t("code",[s._v("完整性")]),s._v("。")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" class "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auto_increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  cname "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("有个班级表class。")]),s._v(" "),t("p",[s._v("然后有个student表")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" student"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auto_increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  gender "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  cid "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("foreign")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("references")]),s._v(" class"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("其中student表中的cid字段，保存的class表的id，这时通过"),t("code",[s._v("foreign key")]),s._v("增加了一个外键。")]),s._v(" "),t("p",[s._v("这时，如果你直接通过student表的id删除数据，会报异常：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("foreign")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("constraint")]),s._v(" fails\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("必须要先删除class表对于的cid那条数据，再删除student表的数据才行，这样能够保证数据的一致性和完整性。")]),s._v(" "),t("blockquote",[t("p",[s._v("顺便说一句：只有存储引擎是innodb时，才能使用外键。")])]),s._v(" "),t("p",[s._v("如果只有两张表的关联还好，但如果有十几张表都建了外键关联，每删除一次主表，都需要同步删除十几张子表，很显然性能会非常差。")]),s._v(" "),t("p",[s._v("因此，互联网系统中，一般建议不使用外键。因为这类系统更多的是为了性能考虑，宁可牺牲一点数据一致性和完整性。")]),s._v(" "),t("p",[s._v("除了"),t("code",[s._v("外键")]),s._v("之外，"),t("code",[s._v("存储过程")]),s._v("和"),t("code",[s._v("触发器")]),s._v("也不太建议使用，他们都会影响性能。")]),s._v(" "),t("h2",{attrs:{id:"_9、索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9、索引"}},[s._v("#")]),s._v(" 9、索引")]),s._v(" "),t("p",[s._v("在建表时，除了指定"),t("code",[s._v("主键索引")]),s._v("之外，还需要创建一些"),t("code",[s._v("普通索引")]),s._v("。")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" product_sku"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auto_increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  spu_id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  brand_id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("在创建商品表时，使用spu_id（商品组表）和brand_id（品牌表）的id。")]),s._v(" "),t("p",[s._v("像这类保存其他表id的情况，可以增加普通索引：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" product_sku "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auto_increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  spu_id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  brand_id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ix_spu_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("spu_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BTREE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ix_brand_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("brand_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BTREE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("后面查表的时候，效率更高。")]),s._v(" "),t("p",[s._v("但索引字段也不能建的太多，可能会影响保存数据的效率，因为索引需要额外的存储空间。")]),s._v(" "),t("p",[s._v("建议单表的索引个数不要超过："),t("code",[s._v("5")]),s._v("个。")]),s._v(" "),t("p",[s._v("如果在建表时，发现索引个数超过5个了，可以删除部分"),t("code",[s._v("普通索引")]),s._v("，改成"),t("code",[s._v("联合索引")]),s._v("。")]),s._v(" "),t("p",[s._v("顺便说一句：在创建联合索引的时候，需要使用注意"),t("code",[s._v("最左匹配原则")]),s._v("，不然，建的联合索引效率可能不高。")]),s._v(" "),t("p",[s._v("对于数据重复率非常高的字段，比如：状态，不建议单独创建普通索引。因为即使加了索引，如果mysql发现"),t("code",[s._v("全表扫描")]),s._v("效率更高，可能会导致索引失效。")]),s._v(" "),t("p",[s._v("如果你对索引失效问题比较感兴趣，可以看看我的另一篇文章《"),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&mid=2247491626&idx=1&sn=18fc949c06f04fe8f4c29b6fc5c66f9c&chksm=c0e838c2f79fb1d45c6f9b2ab188bb4663414690bab0718a7d46beb875e6b83e5e67ec27d2ff&token=660773166&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("聊聊索引失效的10种场景，太坑了"),t("OutboundLink")],1),s._v("》，里面有非常详细的介绍。")]),s._v(" "),t("h2",{attrs:{id:"_10、时间字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10、时间字段"}},[s._v("#")]),s._v(" 10、时间字段")]),s._v(" "),t("p",[t("code",[s._v("时间字段")]),s._v("的类型，我们可以选择的范围还是比较多的，目前mysql支持：date、datetime、timestamp、varchar等。")]),s._v(" "),t("p",[t("code",[s._v("varchar")]),s._v("类型可能是为了跟接口保持一致，接口中的时间类型是String。")]),s._v(" "),t("p",[s._v("但如果哪天我们要通过时间范围查询数据，效率会非常低，因为这种情况没法走索引。")]),s._v(" "),t("p",[t("code",[s._v("date")]),s._v("类型主要是为了保存"),t("code",[s._v("日期")]),s._v("，比如：2020-08-20，不适合保存"),t("code",[s._v("日期和时间")]),s._v("，比如：2020-08-20 12:12:20。")]),s._v(" "),t("p",[s._v("而"),t("code",[s._v("datetime")]),s._v("和"),t("code",[s._v("timestamp")]),s._v("类型更适合我们保存"),t("code",[s._v("日期和时间")]),s._v("。")]),s._v(" "),t("p",[s._v("但它们有略微区别。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("timestamp")]),s._v("：用4个字节来保存数据，它的取值范围为"),t("code",[s._v("1970-01-01 00:00:01")]),s._v(" UTC ~ "),t("code",[s._v("2038-01-19 03:14:07")]),s._v("。此外，它还跟时区有关。")]),s._v(" "),t("li",[t("code",[s._v("datetime")]),s._v("：用8个字节来保存数据，它的取值范围为"),t("code",[s._v("1000-01-01 00:00:00")]),s._v(" ~ "),t("code",[s._v("9999-12-31 23:59:59")]),s._v("。它跟时区无关。")])]),s._v(" "),t("p",[s._v("优先推荐使用"),t("code",[s._v("datetime")]),s._v("类型保存日期和时间，可以保存的时间范围更大一些。")]),s._v(" "),t("blockquote",[t("p",[s._v("温馨提醒一下，在给时间字段设置默认值是，建议不要设置成："),t("code",[s._v("0000-00-00 00:00:00")]),s._v("，不然查询表时可能会因为转换不了，而直接报错。")])]),s._v(" "),t("h2",{attrs:{id:"_11、金额字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11、金额字段"}},[s._v("#")]),s._v(" 11、金额字段")]),s._v(" "),t("p",[s._v("mysql中有多个字段可以表示浮点数：float、double、decimal等。")]),s._v(" "),t("p",[s._v("而"),t("code",[s._v("float")]),s._v("和"),t("code",[s._v("double")]),s._v("可能会丢失精度，因此推荐大家使用"),t("code",[s._v("decimal")]),s._v("类型保存金额。")]),s._v(" "),t("p",[s._v("一般我们是这样定义浮点数的：decimal(m,n)。")]),s._v(" "),t("p",[s._v("其中"),t("code",[s._v("n")]),s._v("是指"),t("code",[s._v("小数")]),s._v("的长度，而"),t("code",[s._v("m")]),s._v("是指"),t("code",[s._v("整数加小数")]),s._v("的总长度。")]),s._v(" "),t("p",[s._v("假如我们定义的金额类型是这样的：decimal(10,2)，则表示整数长度是8位，并且保留2位小数。")]),s._v(" "),t("h2",{attrs:{id:"_12、唯一索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12、唯一索引"}},[s._v("#")]),s._v(" 12、唯一索引")]),s._v(" "),t("p",[t("code",[s._v("唯一索引")]),s._v("在我们实际工作中，使用频率相当高。")]),s._v(" "),t("p",[s._v("你可以给单个字段，加唯一索引，比如：组织机构code。")]),s._v(" "),t("p",[s._v("也可以给多个字段，加一个联合的唯一索引，比如：分类编号、单位、规格等。")]),s._v(" "),t("p",[s._v("单个的唯一索引还好，但如果是联合的唯一索引，字段值出现null时，则唯一性约束可能会失效。")]),s._v(" "),t("p",[s._v("关于唯一索引失效的问题，感兴趣的小伙伴可以看看我的另一篇文章《"),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&mid=2247497090&idx=1&sn=53b81535a9815853382c3a4bff8c844b&chksm=c0e82d6af79fa47ccfece23a8b0ad46ef6c647f1d2f961823eed181732c47e250ed0cbcfe6fd&token=1169141359&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("明明加了唯一索引，为什么还是产生重复数据？"),t("OutboundLink")],1),s._v("》。")]),s._v(" "),t("blockquote",[t("p",[s._v("创建唯一索引时，相关字段一定不能包含null值，否则唯一性会失效。")])]),s._v(" "),t("h2",{attrs:{id:"_13、字符集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13、字符集"}},[s._v("#")]),s._v(" 13、字符集")]),s._v(" "),t("p",[s._v("mysql中支持的"),t("code",[s._v("字符集")]),s._v("有很多，常用的有：latin1、utf-8、utf8mb4、GBK等。")]),s._v(" "),t("p",[s._v("这4种字符集情况如下："),t("img",{attrs:{src:"http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/640",alt:"图片"}})]),s._v(" "),t("p",[t("code",[s._v("latin1")]),s._v("容易出现乱码问题，在实际项目中使用比较少。")]),s._v(" "),t("p",[s._v("而"),t("code",[s._v("GBK")]),s._v("支持中文，但不支持国际通用字符，在实际项目中使用也不多。")]),s._v(" "),t("p",[s._v("从目前来看，mysql的字符集使用最多的还是："),t("code",[s._v("utf-8")]),s._v("和"),t("code",[s._v("utf8mb4")]),s._v("。")]),s._v(" "),t("p",[s._v("其中"),t("code",[s._v("utf-8")]),s._v("占用3个字节，比"),t("code",[s._v("utf8mb4")]),s._v("的4个字节，占用更小的存储空间。")]),s._v(" "),t("p",[s._v("但utf-8有个问题：即无法存储emoji表情，因为emoji表情一般需要4个字节。")]),s._v(" "),t("p",[s._v("由此，使用utf-8字符集，保存emoji表情时，数据库会直接报错。")]),s._v(" "),t("p",[s._v("所以，建议在建表时字符集设置成："),t("code",[s._v("utf8mb4")]),s._v("，会省去很多不必要的麻烦。")]),s._v(" "),t("h2",{attrs:{id:"_14、排序规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14、排序规则"}},[s._v("#")]),s._v(" 14、排序规则")]),s._v(" "),t("p",[s._v("不知道，你关注过没，在mysql中创建表时，有个"),t("code",[s._v("COLLATE")]),s._v("参数可以设置。")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("un_code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("un_code_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BTREE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("idx_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_bin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("它是用来设置"),t("code",[s._v("排序规则")]),s._v("的。")]),s._v(" "),t("p",[s._v("字符排序规则跟字符集有关，比如：字符集如果是"),t("code",[s._v("utf8mb4")]),s._v("，则字符排序规则也是以："),t("code",[s._v("utf8mb4_")]),s._v("开头的，常用的有："),t("code",[s._v("utf8mb4_general_ci")]),s._v("、"),t("code",[s._v("utf8mb4_bin")]),s._v("等。")]),s._v(" "),t("p",[s._v("其中utf8mb4_general_ci排序规则，对字母的大小写不敏感。说得更直白一点，就是不区分大小写。")]),s._v(" "),t("p",[s._v("而utf8mb4_bin排序规则，对字符大小写敏感，也就是区分大小写。")]),s._v(" "),t("p",[s._v("说实话，这一点还是非常重要的。")]),s._v(" "),t("p",[s._v("假如order表中现在有一条记录，name的值是大写的YOYO，但我们用小写的yoyo去查，例如：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yoyo'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果字符排序规则是utf8mb4_general_ci，则可以查出大写的YOYO的那条数据。")]),s._v(" "),t("p",[s._v("如果字符排序规则是utf8mb4_bin，则查不出来。")]),s._v(" "),t("p",[s._v("由此，字符排序规则一定要根据实际的业务场景选择，否则容易出现问题。")]),s._v(" "),t("h2",{attrs:{id:"_15、大字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15、大字段"}},[s._v("#")]),s._v(" 15、大字段")]),s._v(" "),t("p",[s._v("我们在创建表时，对一些特殊字段，要额外关注，比如："),t("code",[s._v("大字段")]),s._v("，即占用较多存储空间的字段。")]),s._v(" "),t("p",[s._v("比如：用户的评论，这就属于一个大字段，但这个字段可长可短。")]),s._v(" "),t("p",[s._v("但一般会对评论的总长度做限制，比如：最多允许输入500个字符。")]),s._v(" "),t("p",[s._v("如果直接定义成"),t("code",[s._v("text")]),s._v("类型，可能会浪费存储空间，所以建议将这类字段定义成"),t("code",[s._v("varchar")]),s._v("类型的存储效率更高。")]),s._v(" "),t("p",[s._v("当然，我还见过更大的字段，即该字段直接保存合同数据。")]),s._v(" "),t("p",[s._v("一个合同可能会占"),t("code",[s._v("几Mb")]),s._v("。")]),s._v(" "),t("p",[s._v("在mysql中保存这种数据，从系统设计的角度来说，本身就不太合理。")]),s._v(" "),t("p",[s._v("像合同这种非常大的数据，可以保存到"),t("code",[s._v("mongodb")]),s._v("中，然后在mysql的业务表中，保存mongodb表的id。")])])}),[],!1,null,null,null);t.default=n.exports}}]);